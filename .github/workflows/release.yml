name: ğŸ“¦ Build and Release KSZ Reader

on:
  push:
    tags:
      - 'v*'  # åªé‡å° push tag (å¦‚ v1.6.4) è§¸ç™¼æ‰“åŒ…èˆ‡ç™¼ä½ˆ

jobs:
  release:
    name: ğŸ›  Build Universal macOS App
    runs-on: macos-latest

    steps:
      # Step 1: å–å¾—åŸå§‹ç¢¼
      - name: ğŸ§¾ Checkout Repository
        uses: actions/checkout@v3

      # Step 2: å®‰è£ Node.jsï¼ˆç”¨æ–¼æ‰“åŒ…ï¼‰
      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      # Step 3: å®‰è£å°ˆæ¡ˆä¾è³´
      - name: ğŸ“¥ Install Dependencies
        run: npm install

      # Step 4: ä½¿ç”¨ electron-builder æ‰“åŒ…
      - name: ğŸ— Build App with electron-builder
        run: npm run dist
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}  # âœ… ä½ è‡ªå»ºçš„ GitHub Personal Access Token

      # Step 5: ä¸Šå‚³ artifacts åˆ° GitHub Releaseï¼ˆå‚™æ´ï¼‰
      - name: ğŸ“¤ Upload Files to GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            dist/*.dmg
            dist/*.zip
            dist/*.blockmap
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # âœ… GitHub é è¨­æä¾›çš„ Tokenï¼Œç„¡éœ€è‡ªå»º
